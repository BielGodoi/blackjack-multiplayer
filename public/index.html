<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé∞ Blackjack Multiplayer</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1a5f3f 0%, #0d3d2a 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .header {
      background: #1a1a1a;
      border-bottom: 3px solid #d4af37;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo { color: #d4af37; font-size: 28px; font-weight: bold; }
    .user-info { color: white; display: flex; gap: 15px; align-items: center; }
    .btn { 
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-green { background: #2d7a4f; color: white; }
    .btn-green:hover { background: #3a9862; }
    .btn-red { background: #c41e3a; color: white; }
    .btn-red:hover { background: #e02444; }
    
    .login-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    .login-box {
      background: #1a1a1a;
      padding: 40px;
      border-radius: 15px;
      border: 3px solid #d4af37;
      max-width: 400px;
      width: 100%;
    }
    .login-box h1 { color: #d4af37; text-align: center; margin-bottom: 30px; }
    .login-box input {
      width: 100%;
      padding: 15px;
      margin-bottom: 15px;
      border: 2px solid #444;
      background: #2a2a2a;
      color: white;
      border-radius: 5px;
      font-size: 16px;
    }
    .login-box input:focus { outline: none; border-color: #d4af37; }
    
    .game-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .dealer-area {
      text-align: center;
      padding: 30px;
      margin-bottom: 30px;
    }
    .dealer-label {
      color: #d4af37;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .cards-area {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
    }
    .card {
      width: 70px;
      height: 100px;
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .card-hidden {
      background: linear-gradient(45deg, #8B0000 0%, #DC143C 100%);
      border: 3px solid #d4af37;
    }
    .card-value { font-size: 18px; font-weight: bold; }
    .card-suit { font-size: 36px; }
    .dealer-total { color: white; font-size: 20px; font-weight: bold; }
    
    .players-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .player-box {
      background: rgba(0,0,0,0.5);
      border: 3px solid #444;
      border-radius: 10px;
      padding: 15px;
    }
    .player-box.active { border-color: #2d7a4f; box-shadow: 0 0 20px #2d7a4f; }
    .player-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    .player-name { color: white; font-weight: bold; font-size: 18px; }
    .player-balance { color: #d4af37; font-weight: bold; }
    
    .bottom-stats {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, #3d1e0e 0%, #2a1508 100%);
      border-top: 3px solid #d4af37;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .stats-left {
      display: flex;
      gap: 40px;
    }
    .stat-item {
      text-align: center;
    }
    .stat-label {
      color: #d4af37;
      font-size: 12px;
      text-transform: uppercase;
      margin-bottom: 5px;
    }
    .stat-value {
      color: white;
      font-size: 24px;
      font-weight: bold;
    }
    
    .betting-area {
      text-align: center;
      padding: 30px;
      margin-bottom: 150px;
    }
    .timer {
      background: #c41e3a;
      color: white;
      font-size: 32px;
      font-weight: bold;
      padding: 15px 30px;
      border-radius: 10px;
      display: inline-block;
      margin-bottom: 30px;
    }
    .chips-container {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 30px;
    }
    .chip {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 5px solid white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }
    .chip:hover { transform: scale(1.1); }
    .chip:active { transform: scale(0.95); }
    .chip-5 { background: #c41e3a; }
    .chip-10 { background: #1e4ac4; }
    .chip-25 { background: #2d7a4f; }
    .chip-50 { background: #7a2d7a; }
    .chip-100 { background: #1a1a1a; border-color: #d4af37; color: #d4af37; }
    
    .bet-display {
      background: rgba(0,0,0,0.7);
      padding: 30px;
      border-radius: 15px;
      border: 2px solid #d4af37;
      display: inline-block;
      min-width: 300px;
      margin-bottom: 20px;
    }
    .bet-amount {
      color: #d4af37;
      font-size: 48px;
      font-weight: bold;
    }
    .bet-label {
      color: #aaa;
      font-size: 14px;
      margin-top: 10px;
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }
    .action-btn {
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-hit { background: #1e4ac4; color: white; }
    .btn-stand { background: #d97706; color: white; }
    .btn-double { background: #7a2d7a; color: white; }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #d4af37;
      color: #1a1a1a;
      padding: 15px 25px;
      border-radius: 8px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      animation: slideIn 0.3s;
    }
    @keyframes slideIn {
      from { transform: translateX(400px); }
      to { transform: translateX(0); }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const socket = io();
    
    let myId = null;
    let gameState = null;
    let myUsername = null;
    let isLoggedIn = false;
    let bettingTimeLeft = 0;

    socket.on('connect', () => console.log('‚úÖ Conectado'));
    socket.on('gameState', (state) => { gameState = state; if (isLoggedIn) render(); });
    socket.on('notification', (data) => showNotification(data.message));
    socket.on('loginSuccess', (data) => { 
      isLoggedIn = true; 
      myUsername = data.username; 
      showNotification(`Bem-vindo! Saldo: $${data.balance}`); 
      render(); 
    });
    socket.on('loginError', (data) => alert(data.message));
    socket.on('bonusSuccess', (data) => { showNotification(`Ganhou $${data.amount}!`); });
    socket.on('bonusError', (data) => alert(data.message));
    socket.on('betError', (data) => showNotification(data.message));
    socket.on('bettingTimer', (data) => { bettingTimeLeft = data.timeLeft; render(); });

    function showNotification(msg) {
      const n = document.createElement('div');
      n.className = 'notification';
      n.textContent = msg;
      document.body.appendChild(n);
      setTimeout(() => n.remove(), 3000);
    }

    function login() {
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      if (u && p) socket.emit('login', { username: u, password: p });
    }

    function addPlayer() {
      const n = document.getElementById('playerName').value.trim();
      if (n && !myId) { socket.emit('addPlayer', { name: n, username: myUsername }); myId = socket.id; }
    }

    function startBetting() { socket.emit('startBetting'); }
    
    function placeBet(amount) {
      console.log('üé≤ Clicou na ficha de $' + amount);
      socket.emit('placeBet', { amount: amount });
    }
    
    function confirmBet() { socket.emit('confirmBet'); }
    function clearBet() { socket.emit('clearBet'); }
    function hit() { socket.emit('hit'); }
    function stand() { socket.emit('stand'); }
    function double() { socket.emit('double'); }
    function newRound() { socket.emit('newRound'); }
    function leaveTable() { if (confirm('Sair?')) { socket.emit('leaveTable'); myId = null; render(); } }
    function claimBonus() { socket.emit('claimDailyBonus', { username: myUsername }); }

    function renderCard(c) {
      if (c.hidden) return '<div class="card card-hidden"></div>';
      const colors = { hearts: '#dc2626', diamonds: '#dc2626', clubs: '#1e293b', spades: '#1e293b' };
      const symbols = { hearts: '‚ô•', diamonds: '‚ô¶', clubs: '‚ô£', spades: '‚ô†' };
      return `<div class="card">
        <div class="card-value" style="color:${colors[c.suit]}">${c.value}</div>
        <div class="card-suit" style="color:${colors[c.suit]}">${symbols[c.suit]}</div>
        <div class="card-value" style="color:${colors[c.suit]}">${c.value}</div>
      </div>`;
    }

    function renderPlayer(p, active) {
      const me = p.id === myId;
      return `<div class="player-box ${active ? 'active' : ''}">
        <div class="player-header">
          <span class="player-name">${p.name}${me ? ' (VOC√ä)' : ''}</span>
          <span class="player-balance">$${p.balance}</span>
        </div>
        ${p.cards.length > 0 ? `
          <div class="cards-area">${p.cards.map(c => renderCard(c)).join('')}</div>
          <div style="text-align:center;color:white;font-weight:bold;margin-top:10px;">
            ${p.result || (p.busted ? '‚ùå ESTOUROU' : p.blackjack ? 'üé∞ BLACKJACK' : `Total: ${p.total}`)}
          </div>
        ` : `<div style="text-align:center;color:#aaa;padding:20px;">
          ${p.betPlaced ? `‚úÖ Apostou $${p.bet}` : (p.bet > 0 ? `üí≠ $${p.bet}` : '‚è≥ Aguardando...')}
        </div>`}
      </div>`;
    }

    function render() {
      const app = document.getElementById('app');
      
      if (!isLoggedIn) {
        app.innerHTML = `
          <div class="login-screen">
            <div class="login-box">
              <h1>üé∞ BLACKJACK</h1>
              <input type="text" id="username" placeholder="Usu√°rio" />
              <input type="password" id="password" placeholder="Senha" onkeypress="if(event.key==='Enter')login()" />
              <button onclick="login()" class="btn btn-green" style="width:100%;padding:15px;font-size:18px;">ENTRAR</button>
              <p style="color:#aaa;text-align:center;margin-top:15px;font-size:14px;">Novo? Ser√° criado com $1000</p>
            </div>
          </div>
        `;
        return;
      }
      
      if (!gameState) return;
      
      const myP = gameState.players.find(p => p.id === myId);
      
      if (!myId) {
        app.innerHTML = `
          <div class="header">
            <div class="logo">BLACKJACK</div>
            <div class="user-info">
              <span>üë§ ${myUsername}</span>
              <button onclick="claimBonus()" class="btn btn-green">üéÅ B√îNUS</button>
            </div>
          </div>
          <div class="login-screen">
            <div class="login-box">
              <h1>ENTRAR NA MESA</h1>
              <input type="text" id="playerName" placeholder="Seu apelido" />
              <button onclick="addPlayer()" class="btn btn-green" style="width:100%;padding:15px;font-size:18px;">ENTRAR</button>
            </div>
          </div>
        `;
        return;
      }
      
      let html = `
        <div class="header">
          <div class="logo">BLACKJACK</div>
          <div class="user-info">
            <span>üë§ ${myUsername}</span>
            <button onclick="claimBonus()" class="btn btn-green">üéÅ</button>
            ${gameState.status === 'lobby' ? `<button onclick="leaveTable()" class="btn btn-red">SAIR</button>` : ''}
          </div>
        </div>
        
        <div class="game-container">
      `;
      
      if (gameState.status === 'lobby') {
        html += `
          <div style="text-align:center;padding:50px;">
            <h2 style="color:#d4af37;margin-bottom:30px;">JOGADORES NA MESA (${gameState.players.length}/7)</h2>
            <div class="players-grid">
              ${gameState.players.map(p => `
                <div class="player-box">
                  <div class="player-header">
                    <span class="player-name">${p.name}</span>
                    <span class="player-balance">$${p.balance}</span>
                  </div>
                </div>
              `).join('')}
            </div>
            <button onclick="startBetting()" class="btn btn-green" style="padding:20px 60px;font-size:24px;margin-top:30px;">üí∞ INICIAR RODADA</button>
          </div>
        `;
      }
      
      if (gameState.status === 'betting') {
        html += `
          <div class="betting-area">
            <div class="timer">${bettingTimeLeft}s</div>
            
            ${myP && !myP.betPlaced ? `
              <div class="chips-container">
                <div class="chip chip-5" onclick="placeBet(5)">$5</div>
                <div class="chip chip-10" onclick="placeBet(10)">$10</div>
                <div class="chip chip-25" onclick="placeBet(25)">$25</div>
                <div class="chip chip-50" onclick="placeBet(50)">$50</div>
                <div class="chip chip-100" onclick="placeBet(100)">$100</div>
              </div>
              
              <div class="bet-display">
                <div class="bet-amount">$${myP.bet}</div>
                <div class="bet-label">Sua Aposta</div>
              </div>
              
              <div style="display:flex;gap:15px;justify-content:center;">
                <button onclick="clearBet()" class="btn btn-red" style="padding:15px 40px;font-size:18px;">LIMPAR</button>
                <button onclick="confirmBet()" class="btn btn-green" style="padding:15px 40px;font-size:18px;">CONFIRMAR</button>
              </div>
            ` : '<h2 style="color:white;">Aguardando outros jogadores...</h2>'}
          </div>
          
          <h3 style="color:#d4af37;text-align:center;margin-bottom:20px;">STATUS DOS JOGADORES</h3>
          <div class="players-grid">
            ${gameState.players.map(p => renderPlayer(p, false)).join('')}
          </div>
        `;
      }
      
      if (gameState.status === 'playing' || gameState.status === 'finished') {
        html += `
          <div class="dealer-area">
            <div class="dealer-label">üé© DEALER</div>
            <div class="cards-area">${gameState.dealer.cards.map(c => renderCard(c)).join('')}</div>
            <div class="dealer-total">${gameState.dealer.cards.some(c => !c.hidden) ? `Total: ${gameState.dealer.total}` : ''}</div>
          </div>
          
          <div class="players-grid">
            ${gameState.players.map((p, i) => renderPlayer(p, gameState.status === 'playing' && i === gameState.currentPlayer)).join('')}
          </div>
          
          ${gameState.status === 'playing' && gameState.players[gameState.currentPlayer]?.id === myId && !gameState.players[gameState.currentPlayer]?.standing ? `
            <div style="text-align:center;margin-top:30px;margin-bottom:150px;">
              <h2 style="color:#d4af37;margin-bottom:20px;">üéØ SUA VEZ!</h2>
              <div class="action-buttons">
                <button onclick="hit()" class="action-btn btn-hit">üÉè PEDIR</button>
                <button onclick="stand()" class="action-btn btn-stand">‚úã PARAR</button>
                ${gameState.players[gameState.currentPlayer].canDouble ? `<button onclick="double()" class="action-btn btn-double">‚ö° DOBRAR</button>` : ''}
              </div>
            </div>
          ` : ''}
          
          ${gameState.status === 'finished' ? `
            <div style="text-align:center;margin-bottom:150px;">
              <button onclick="newRound()" class="btn btn-green" style="padding:20px 60px;font-size:24px;">üîÑ PR√ìXIMA RODADA</button>
            </div>
          ` : ''}
        `;
      }
      
      html += '</div>';
      
      if (myP) {
        const lastWin = myP.result ? (myP.result.includes('+') ? myP.result.match(/\+\$(\d+)/)?.[1] || '0' : '0') : '0';
        html += `
          <div class="bottom-stats">
            <div class="stats-left">
              <div class="stat-item">
                <div class="stat-label">BALANCE</div>
                <div class="stat-value">$${myP.balance.toFixed(2)}</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">TOTAL BET</div>
                <div class="stat-value">$${myP.bet.toFixed(2)}</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">TOTAL WIN</div>
                <div class="stat-value">$${lastWin}</div>
              </div>
            </div>
          </div>
        `;
      }
      
      app.innerHTML = html;
    }

    render();
  </script>
</body>
</html>
