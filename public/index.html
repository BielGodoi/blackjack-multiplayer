<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé∞ Blackjack Multiplayer</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-green-900 via-green-800 to-emerald-900 min-h-screen">
  <div id="app"></div>

  <script>
    const socket = io();
    
    let myId = null;
    let gameState = null;
    let myUsername = null;
    let isLoggedIn = false;
    let bettingTimeLeft = 0;

    socket.on('connect', () => console.log('‚úÖ Conectado'));
    socket.on('gameState', (state) => { gameState = state; if (isLoggedIn) render(); });
    socket.on('notification', (data) => showNotification(data.message));
    socket.on('loginSuccess', (data) => { isLoggedIn = true; myUsername = data.username; showNotification(`Bem-vindo! Saldo: $${data.balance}`); render(); });
    socket.on('loginError', (data) => alert(data.message));
    socket.on('bonusSuccess', (data) => { showNotification(`Ganhou $${data.amount}!`); render(); });
    socket.on('bonusError', (data) => alert(data.message));
    socket.on('betError', (data) => showNotification(data.message));
    socket.on('bettingTimer', (data) => { bettingTimeLeft = data.timeLeft; render(); });

    function showNotification(msg) {
      const n = document.createElement('div');
      n.className = 'fixed top-4 right-4 bg-yellow-500 text-white px-6 py-3 rounded-lg shadow-2xl font-bold z-50';
      n.textContent = msg;
      document.body.appendChild(n);
      setTimeout(() => n.remove(), 3000);
    }

    function login() {
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      if (u && p) socket.emit('login', { username: u, password: p });
    }

    function addPlayer() {
      const n = document.getElementById('playerName').value.trim();
      if (n && !myId) { socket.emit('addPlayer', { name: n, username: myUsername }); myId = socket.id; }
    }

    function startBetting() { socket.emit('startBetting'); }
    function placeBet(a) { socket.emit('placeBet', { amount: a }); }
    function confirmBet() { socket.emit('confirmBet'); }
    function clearBet() { socket.emit('clearBet'); }
    function hit() { socket.emit('hit'); }
    function stand() { socket.emit('stand'); }
    function split() { socket.emit('split'); }
    function double() { socket.emit('double'); }
    function newRound() { socket.emit('newRound'); }
    function leaveTable() { if (confirm('Sair?')) { socket.emit('leaveTable'); myId = null; render(); } }
    function claimBonus() { socket.emit('claimDailyBonus', { username: myUsername }); }

    function renderCard(c) {
      const s = { hearts: '‚ô•', diamonds: '‚ô¶', clubs: '‚ô£', spades: '‚ô†' };
      const col = { hearts: '#dc2626', diamonds: '#dc2626', clubs: '#1e293b', spades: '#1e293b' };
      if (c.hidden) return '<div class="w-16 h-24 bg-red-900 rounded-lg border-2 border-yellow-500 shadow-xl"></div>';
      return `<div class="w-16 h-24 bg-white rounded-lg border border-gray-400 flex flex-col items-center justify-between p-2 shadow-xl">
        <div class="text-sm font-black" style="color:${col[c.suit]}">${c.value}</div>
        <div class="text-3xl" style="color:${col[c.suit]}">${s[c.suit]}</div>
        <div class="text-sm font-black" style="color:${col[c.suit]}">${c.value}</div>
      </div>`;
    }

    function renderPlayer(p, active) {
      const me = p.id === myId;
      return `<div class="bg-gray-900/90 p-4 rounded-xl border-2 ${active ? 'border-green-400' : 'border-gray-700'}">
        <div class="flex justify-between mb-2">
          <span class="text-white font-bold">${p.name}${me ? ' (VOC√ä)' : ''}</span>
          <span class="text-yellow-400 font-bold">$${p.balance}</span>
        </div>
        ${p.cards.length > 0 ? `
          <div class="flex gap-2 mb-2 justify-center">${p.cards.map(c => renderCard(c)).join('')}</div>
          <div class="text-center text-white font-bold">${p.result || (p.busted ? 'ESTOUROU' : p.blackjack ? 'BLACKJACK' : `Total: ${p.total}`)}</div>
        ` : `<div class="text-center text-gray-400 py-4">${p.betPlaced ? `‚úÖ $${p.bet}` : (p.bet > 0 ? `üí≠ $${p.bet}` : '‚è≥')}</div>`}
      </div>`;
    }

    function render() {
      const app = document.getElementById('app');
      
      // LOGIN
      if (!isLoggedIn) {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-gray-900/95 p-8 rounded-2xl border-4 border-yellow-500 max-w-md w-full">
              <h1 class="text-4xl font-black text-yellow-400 text-center mb-8">üé∞ BLACKJACK</h1>
              <input type="text" id="username" placeholder="Usu√°rio" class="w-full px-4 py-3 mb-4 rounded-lg bg-gray-800 text-white border-2 border-gray-700 focus:border-yellow-400 outline-none" />
              <input type="password" id="password" placeholder="Senha" class="w-full px-4 py-3 mb-4 rounded-lg bg-gray-800 text-white border-2 border-gray-700 focus:border-yellow-400 outline-none" onkeypress="if(event.key==='Enter')login()" />
              <button onclick="login()" class="w-full py-4 bg-green-600 hover:bg-green-700 text-white font-black text-xl rounded-xl">ENTRAR</button>
              <p class="text-gray-400 text-center text-sm mt-4">Novo? Ser√° criado com $1000</p>
            </div>
          </div>
        `;
        return;
      }
      
      if (!gameState) return;
      
      const myP = gameState.players.find(p => p.id === myId);
      
      // LOBBY - Entrar na mesa
      if (!myId) {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-gray-900/95 p-8 rounded-2xl border-4 border-yellow-500 max-w-md w-full">
              <div class="flex justify-between mb-6">
                <h2 class="text-2xl font-black text-white">Entrar na Mesa</h2>
                <button onclick="claimBonus()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg text-sm">üéÅ B√îNUS</button>
              </div>
              <input type="text" id="playerName" placeholder="Seu apelido" class="w-full px-4 py-3 mb-4 rounded-lg bg-gray-800 text-white border-2 border-gray-700 outline-none" />
              <button onclick="addPlayer()" class="w-full py-4 bg-green-600 hover:bg-green-700 text-white font-black text-xl rounded-xl">ENTRAR</button>
            </div>
          </div>
        `;
        return;
      }
      
      // HEADER
      let html = `<div class="bg-gray-900/95 border-b-4 border-yellow-500 p-4">
        <div class="container mx-auto flex justify-between items-center">
          <h1 class="text-2xl font-black text-yellow-400">üé∞ BLACKJACK</h1>
          <div class="flex gap-4 items-center">
            <span class="text-white font-bold">üë§ ${myUsername}</span>
            <button onclick="claimBonus()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg">üéÅ</button>
            ${gameState.status === 'lobby' ? `<button onclick="leaveTable()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg">SAIR</button>` : ''}
          </div>
        </div>
      </div>`;
      
      // LOBBY - Na mesa
      if (gameState.status === 'lobby') {
        html += `<div class="container mx-auto p-4 max-w-4xl">
          <div class="bg-gray-900/95 p-6 rounded-2xl border-4 border-gray-700">
            <h3 class="text-xl font-bold text-white mb-4">Jogadores (${gameState.players.length}/7)</h3>
            <div class="grid grid-cols-2 gap-3 mb-6">
              ${gameState.players.map(p => `<div class="bg-gray-800/60 p-3 rounded-lg"><span class="text-white font-bold">${p.name}</span><span class="text-green-400 float-right">$${p.balance}</span></div>`).join('')}
            </div>
            <button onclick="startBetting()" class="w-full py-4 bg-green-600 hover:bg-green-700 text-white font-black text-xl rounded-xl">üí∞ INICIAR RODADA</button>
          </div>
        </div>`;
      }
      
      // APOSTAS
      if (gameState.status === 'betting') {
        html += `<div class="container mx-auto p-4 max-w-4xl">
          ${myP && !myP.betPlaced ? `
            <div class="bg-gray-900/95 p-6 rounded-2xl border-4 border-yellow-500 mb-4">
              <div class="flex justify-between mb-4">
                <h3 class="text-2xl font-black text-white">Sua Aposta</h3>
                <div class="bg-red-600 px-4 py-2 rounded-xl"><span class="text-white font-black text-2xl">${bettingTimeLeft}s</span></div>
              </div>
              
              <div class="flex gap-3 justify-center mb-6">
                <button onclick="placeBet(5)" class="w-16 h-16 bg-red-600 hover:bg-red-700 border-4 border-white rounded-full text-white font-black shadow-2xl active:scale-95">$5</button>
                <button onclick="placeBet(10)" class="w-16 h-16 bg-blue-600 hover:bg-blue-700 border-4 border-white rounded-full text-white font-black shadow-2xl active:scale-95">$10</button>
                <button onclick="placeBet(25)" class="w-16 h-16 bg-green-600 hover:bg-green-700 border-4 border-white rounded-full text-white font-black shadow-2xl active:scale-95">$25</button>
                <button onclick="placeBet(50)" class="w-20 h-20 bg-purple-600 hover:bg-purple-700 border-4 border-white rounded-full text-white font-black text-lg shadow-2xl active:scale-95">$50</button>
                <button onclick="placeBet(100)" class="w-20 h-20 bg-black hover:bg-gray-900 border-4 border-yellow-400 rounded-full text-yellow-400 font-black text-lg shadow-2xl active:scale-95">$100</button>
              </div>
              
              <div class="bg-black/40 p-4 rounded-lg mb-4 text-center">
                <p class="text-yellow-400 font-black text-4xl">$${myP.bet}</p>
                <p class="text-gray-400 text-sm">Saldo: $${myP.balance}</p>
              </div>
              
              <div class="flex gap-3">
                <button onclick="clearBet()" class="flex-1 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl">LIMPAR</button>
                <button onclick="confirmBet()" class="flex-1 py-3 bg-green-600 hover:bg-green-700 text-white font-black text-lg rounded-xl ${myP.bet < 5 ? 'opacity-50' : ''}">CONFIRMAR</button>
              </div>
            </div>
          ` : ''}
          
          <div class="bg-gray-900/95 p-6 rounded-2xl border-4 border-gray-700">
            <h3 class="text-lg font-bold text-white mb-3">Status</h3>
            <div class="grid grid-cols-2 gap-3">
              ${gameState.players.map(p => `<div class="bg-gray-800/60 p-3 rounded-lg border-2 ${p.betPlaced ? 'border-green-500' : 'border-gray-700'}">
                <span class="text-white font-bold">${p.name.substring(0,10)}</span>
                <span class="float-right ${p.betPlaced ? 'text-green-400' : 'text-yellow-400'}">${p.betPlaced ? '‚úÖ' : ''} $${p.bet || 0}</span>
              </div>`).join('')}
            </div>
          </div>
        </div>`;
      }
      
      // JOGANDO
      if (gameState.status === 'playing' || gameState.status === 'finished') {
        html += `<div class="container mx-auto p-4 max-w-6xl">
          <div class="bg-red-900/90 p-4 rounded-2xl border-4 border-red-600 mb-4">
            <h3 class="text-xl font-black text-white text-center mb-3">üé© DEALER</h3>
            <div class="flex gap-2 justify-center mb-2">${gameState.dealer.cards.map(c => renderCard(c)).join('')}</div>
            <div class="text-center text-white font-bold">${gameState.dealer.cards.some(c => !c.hidden) ? `Total: ${gameState.dealer.total}` : ''}</div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
            ${gameState.players.map((p, i) => renderPlayer(p, gameState.status === 'playing' && i === gameState.currentPlayer)).join('')}
          </div>
          
          ${gameState.status === 'playing' && gameState.players[gameState.currentPlayer]?.id === myId && !gameState.players[gameState.currentPlayer]?.standing ? `
            <div class="bg-gray-900/95 p-6 rounded-2xl border-4 border-yellow-500">
              <p class="text-center text-xl font-bold text-white mb-4">üéØ SUA VEZ!</p>
              <div class="flex gap-3 justify-center flex-wrap">
                <button onclick="hit()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-black rounded-xl">üÉè PEDIR</button>
                <button onclick="stand()" class="px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white font-black rounded-xl">‚úã PARAR</button>
                ${gameState.players[gameState.currentPlayer].canDouble ? `<button onclick="double()" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-black rounded-xl">‚ö° DOBRAR</button>` : ''}
                ${gameState.players[gameState.currentPlayer].canSplit ? `<button onclick="split()" class="px-6 py-3 bg-pink-600 hover:bg-pink-700 text-white font-black rounded-xl">‚úÇÔ∏è DIVIDIR</button>` : ''}
              </div>
            </div>
          ` : ''}
          
          ${gameState.status === 'finished' ? `
            <button onclick="newRound()" class="w-full py-4 bg-green-600 hover:bg-green-700 text-white font-black text-xl rounded-xl">üîÑ PR√ìXIMA RODADA</button>
          ` : ''}
        </div>`;
      }
      
      app.innerHTML = html;
    }

    render();
  </script>
</body>
</html>
